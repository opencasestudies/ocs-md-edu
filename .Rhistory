sch=School.Name, grad.rate=Grad.Rate)
summary(df_grad[, c('sch', 'grad.rate')])
df_grad$grad.rate<- gsub('<= 5.00','2.5', df_grad$grad.rate)
df_grad$grad.rate <- gsub('>= 95.00','97.5', df_grad$grad.rate)
head(df_grad[df_grad$grad.rate == '*', ])
df_grad$grad.rate <- na_if(df_grad$grad.rate, '*')
df_grad$grad.rate <- as.numeric(df_grad$grad.rate)
summary(df_grad[,c('sch.num', 'sch')])
df_grad <- df_grad %>%
within( id <- paste(county, sch, sep = '-'))
tab <- as.data.frame(table(df_grad$id))
tab[tab$Freq > 1,]
colnames(data[[2]])
df_parcc <- data[[2]] %>%
filter( School.Number != 'A' ) %>%
select(3,4,5,6,9,11,13,15,17)
colnames(df_parcc) <- c('county','sch.num',
'sch', 'subject','L1',
'L2','L3','L4','L5')
df_parcc <- df_parcc %>%
filter(subject %in% c('English/Language Arts Grade 10','Algebra 1','Algebra 2'))
summary(df_parcc[, 5:9])
df_parcc[,5:9] <-
lapply(df_parcc[,5:9], function(x) as.numeric(as.character(x)))
df_parcc$pro <- NA
indx1 <- !is.na(df_parcc$L4) &  !is.na(df_parcc$L5)
df_parcc[indx1, 'pro'] <- rowSums(df_parcc[indx1,8:9])
sum(is.na(df_parcc$pro))
indx2 <- !is.na(df_parcc$L1) &  !is.na(df_parcc$L2) & !is.na(df_parcc$L3)
df_parcc[indx2, 'pro'] <-  100-rowSums(df_parcc[indx2,5:7])
sum(is.na(df_parcc$pro))
indx3 <- is.na(df_parcc$pro)
na_sum <- 100-rowSums(df_parcc[indx3, 5:9], na.rm = TRUE)
n <- rowSums(is.na(df_parcc[indx3, 5:9]))
na <- round(na_sum/n,1)
for (i in 1:length(indx3)){
df_parcc[indx3, 5:9][i,which(is.na(df_parcc[indx3, 5:9][i,]))] <- na[i]
}
df_parcc[indx3, 'pro'] <- rowSums(df_parcc[indx3,8:9])
sum(is.na(df_parcc$pro))
pac <- df_parcc %>%
within( id <- paste(county, sch, sep = '-')) %>%
select(county, sch.num, sch, subject, pro, id)
tail(pac)
pac <- pac %>%
filter( county != 'SEED')
df_ela <- pac[grep("English/Language Arts Grade 10", pac$subject), ]
df_alg1 <- pac[grep("Algebra 1", pac$subject), ]
df_alg2 <- pac[grep("Algebra 2", pac$subject), ]
dim(df_ela)  #size of df_ela
dim(df_alg1) #size of df_alg1
dim(df_alg2) #size of df_alg2
head(df_alg1)
df_alg1 <- df_alg1 %>%
filter(id %in% df_grad$id)
dim(df_alg1)
df_spc <- data[[3]] %>%
filter( School.Number != 'A', School.Type == 'High' ) %>%
within( id <- paste(LEA.Name, School.Name, sep = '-')) %>%
select(LEA.Name, School.Number, School.Name,
FARMS.Pct, id)
colnames(df_spc) <- c('county', 'sch.num', 'sch', 'farms', 'id')
summary(df_spc)
df_spc[df_spc$farms == '*',]
df_spc$farms <- gsub('<= 5.0','2.5', df_spc$farms)
df_spc$farms <- as.numeric(df_spc$farms)
df_mob <- data[[4]] %>%
filter( School.Number != 'A', School.Type == 'High' )%>%
within( id <- paste(LEA.Name, School.Name, sep = '-')) %>%
select(LEA.Name, School.Number,
School.Name, Withdrawals.Pct, id)
colnames(df_mob) <- c('county', 'sch.num', 'sch', 'withdraw', 'id')
summary(df_mob)
df_mob$withdraw <- gsub('<= 5.0','2.5', df_mob$withdraw)
df_mob$withdraw <- gsub('>= 95.0','97.5', df_mob$withdraw)
df_mob$withdraw <- as.numeric(df_mob$withdraw)
df_exp <- data[[5]] %>%
mutate(exp = round(Wealth.Per.Pupil/Expenditures.Per.Pupil, 1)) %>%
select(LEA.Name, exp)
colnames(df_exp) <- c('county','exp')
temp <- df_ela %>%
select(id, county, pro) %>%
left_join(df_grad[, c('grad.rate', 'id')], by = 'id')
head(temp)
tail(temp)
temp1 <- df_ela %>%
select(id, county, pro) %>%
left_join(df_grad[, c('grad.rate', 'id')], by = 'id') %>%
left_join( df_mob[, c('withdraw', 'id')], by = 'id') %>%
left_join( df_spc[, c('farms', 'id')], by = 'id') %>%
left_join(df_exp, by = 'county')
L_ela <- list(df_ela[, c('id', 'county', 'pro')],
df_grad[, c('id','grad.rate')],
df_mob[, c('id','withdraw')],
df_spc[, c('id','farms')], df_exp)
temp2 <- Reduce(function(x,y) left_join(x, y,
by = colnames(y)[1]), L_ela)
# `by = colnames(y)[1])` tells how to find the *keys* in each left_join.
func_merge <- function(data){
L <- list(data[, c('id', 'county', 'pro')],
df_grad[, c('id','grad.rate')],
df_mob[, c('id','withdraw')],
df_spc[, c('id','farms')], df_exp)
final_data<- Reduce(function(x,y) left_join(x, y,
by = colnames(y)[1]), L)
return(final_data)
}
df_ELA <- func_merge(df_ela)
df_ALG1 <- func_merge(df_alg1)
df_ALG2 <- func_merge(df_alg2)
# Boxplot
p1 <- ggplot(df_ALG1, aes(x = reorder(county, pro),
y = pro,fill = county)) + geom_boxplot()+
guides(fill = FALSE) + theme_bw() +
theme(plot.title = element_text(hjust = 0.5 ),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 90, hjust = 1,vjust = 0.5)) +
labs( y = 'Distribution',
caption = 'proportion of high performance for Algebra 1 in year 2017')
ALG1_sum <- df_ALG1 %>%
group_by(county) %>%
summarise(mean = mean(pro),
sd = sd(pro))
# Line plot
p2 <- ggplot(ALG1_sum, aes( reorder(factor(county), mean), mean, group = 1)) +
geom_line(alpha = 1/3) +
geom_pointrange(aes(ymax = mean + sd, ymin = mean - sd)) +
labs(caption = 'Error bars') +
theme_minimal() +
theme( axis.title.x = element_blank(),
axis.text.x = element_text(angle = 90, hjust = 1,vjust = 0.5))
ggarrange(p1, p2, ncol = 2)
distplot <- function(data, var, var.name){
p <- ggplot(data, aes(x = reorder(county, var),
y = var, fill = county)) + geom_boxplot()+
guides(fill = FALSE) + theme_bw() +
theme(plot.title = element_text(hjust = 0.5 ),
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 90, hjust = 1,vjust = 0.5))+
labs( y = paste("Distribution of ", var.name),
caption = deparse(substitute(data)))
return(p)
}
p3 <- distplot(df_ALG1, df_ALG1$pro, "pro")
p4 <- distplot(df_ALG2, df_ALG2$pro, "pro")
p5 <- distplot(df_ELA, df_ELA$pro, "pro")
ggarrange(p3, p4, p5, nrow = 2, ncol = 2)
p6 <- distplot(df_ALG1, df_ALG1$grad.rate, "grad.rate")
p7 <- distplot(df_ALG1, df_ALG1$farms, "farms")
p8 <- distplot(df_ALG1, df_ALG1$withdraw, "withdraw")
p9 <- distplot(df_ALG1, df_ALG1$exp, "exp")
ggarrange(p6,p7, p8, p9, nrow = 2, ncol = 2)
df_ALG1 <- df_ALG1 %>%
mutate( grad.rate.ct = grad.rate - mean(grad.rate, na.rm = TRUE)) %>%
mutate( withdraw.ct = withdraw - mean(withdraw, na.rm = TRUE))
p10 <- distplot(df_ALG1, df_ALG1$grad.rate.ct, "grad.rate.ct")
p11 <- distplot(df_ALG1, df_ALG1$withdraw.ct, "withdraw.ct")
ggarrange(p10, p11, ncol = 2 )
relaplot1 <- function(var, var.name){
p <- ggplot(df_ALG1, aes(x = var, y = pro))+
geom_point()+ geom_smooth(se = FALSE)+
theme(legend.position = "none") +
labs(x = var.name)
return(p)
}
relaplot2 <- function(var, var.name){
p <- ggplot(data = df_ALG1, aes(x = var , y = pro,group = county))+
facet_wrap( ~ county, switch = 'x', nrow = 3)+
geom_point(aes(colour = county))+
geom_smooth(se = FALSE, aes(colour = county))+
theme(strip.text=element_text())+
theme(legend.position = "none") +
theme(axis.text = element_blank(),
axis.ticks = element_blank()) +
labs(x = var.name)
return(p)
}
p12 <- relaplot1(df_ALG1$farms, "farms")
p13 <- relaplot2(df_ALG1$farms, "farms")
p14 <- relaplot1(df_ALG1$grad.rate.ct, "grad.rate.ct")
p15 <- relaplot2(df_ALG1$grad.rate.ct, "grad.rate.ct")
ggarrange(p12,p13,p14,p15, ncol = 2, nrow = 2, widths = c(3,6))
m <- lm(pro ~ grad.rate + withdraw + farms + exp, data = df_ELA)
summary(m)
m1 <- lmer(pro ~ 1 + 1|county, data = df_ALG1)
summary(m1)
m2 <- lmer(pro ~ grad.rate.ct + (1|county), data = df_ALG1)
summary(m2)
m3 <- lmer(pro ~ grad.rate.ct + (grad.rate.ct |county), data = df_ALG1,
control = lmerControl(optimizer ="Nelder_Mead"))
summary(m3)
as.data.frame(VarCorr(m3))
m4 <- lmer(pro ~ farms + (1 |county), data = df_ALG1)
summary(m4)
m5 <- lmer(pro ~ farms + (farms |county), data = df_ALG1,
control = lmerControl(optimizer ="Nelder_Mead"))
summary(m5)
library(lmerTest)
m6 <- lmer(pro ~ farms + (farms |county), data = df_ALG1,
control = lmerControl(optimizer ="Nelder_Mead"))
summary(m6)
df_temp <- na.omit(df_ALG1)
m6 <- lmer(pro ~ grad.rate.ct + withdraw.ct + farms + exp +
(farms|county), data = df_temp,
control = lmerControl(optimizer ="Nelder_Mead"))
summary(m6)
plot(m6)
plot(m4)
qqnorm(resid(m4))
qqnorm(resid(m6))
qqline(resid(m6))
qqnorm(resid(m6), ~ranef(., level=1))
qqnorm(resid(m6), ~ranef(., level=1))
qqline(resid(m6),  ~ranef(., level=1))
qqnorm(resid(m6), ~ranef(., level=2))
qqnorm(resid(m6))
qqline(resid(m6))
plot( m6, resid(., type = "p") ~ fitted(.) | farms)
plot( m6, resid(., type = "pearson") ~ fitted(.) | farms)
plot( m6, resid(., type = "pearson") ~ fitted(.) | county)
plot( m6)
residuals(m6,type="pearson")
plot(residuals(m6,type="pearson"), df_temp$county)
plot(df_temp$county, residuals(m6,type="pearson"))
resi <- resid(m6)
resi <- resid(m6)
plot(resi, df_temp$farms)
plot(resi, df_temp$grad.rate.ct)
plot(resi, df_temp$withdraw.ct)
plot(resi, df_temp$exp)
par(mfrow = c(2, 2))
par(mfrow = c(2, 2))
resi <- resid(m6)
plot(resi, df_temp$farms)
plot(resi, df_temp$grad.rate.ct)
plot(resi, df_temp$withdraw.ct)
plot(resi, df_temp$exp)
par(mfrow = c(2, 2))
par(mfrow = c(2, 2))
resi <- resid(m6)
plot(resi, df_temp$farms)
plot(resi, log(df_temp$grad.rate.ct))
plot(resi, log(df_temp$withdraw.ct))
plot(resi, df_temp$exp)
relaplot1(log(df_ALG1$grad.rate.ct), "log grad.rate.ct")
relaplot1(exp(df_ALG1$grad.rate.ct), "log grad.rate.ct")
relaplot1(logit(df_ALG1$grad.rate.ct), "log grad.rate.ct")
relaplot1(log(df_ALG1$withdraw.ct), "log grad.rate.ct")
relaplot1 <- function(var, var.name){
p <- ggplot(df_ALG1, aes(x = var, y = pro))+
geom_point()+ geom_smooth(se = FALSE)+
theme(legend.position = "none") +
labs(x = var.name)
return(p)
}
relaplot2 <- function(var, var.name){
p <- ggplot(data = df_ALG1, aes(x = var , y = pro,group = county))+
facet_wrap( ~ county, switch = 'x', nrow = 3)+
geom_point(aes(colour = county))+
geom_smooth(se = FALSE, aes(colour = county))+
theme(strip.text=element_text())+
theme(legend.position = "none") +
theme(axis.text = element_blank(),
axis.ticks = element_blank()) +
labs(x = var.name)
return(p)
}
p12 <- relaplot1(df_ALG1$farms, "farms")
p13 <- relaplot2(df_ALG1$farms, "farms")
p14 <- relaplot1(df_ALG1$grad.rate.ct, "grad.rate.ct")
p15 <- relaplot2(df_ALG1$grad.rate.ct, "grad.rate.ct")
ggarrange(p12,p13,p14,p15, ncol = 2, nrow = 2, widths = c(3,6))
p16 <- relaplot1(log(df_ALG1$grad.rate.ct), "log grad.rate.ct")
p17 <- relaplot1(log(df_ALG1$withdraw.ct), "log withdraw.ct")
p18 <- relaplot1(df_ALG1$exp, "exp")
ggarrange(p16,p17,p18 ncol = 3, nrow = 1)
p16 <- relaplot1(log(df_ALG1$grad.rate.ct), "log grad.rate.ct")
p17 <- relaplot1(log(df_ALG1$withdraw.ct), "log withdraw.ct")
p18 <- relaplot1(df_ALG1$exp, "exp")
ggarrange(p16,p17,p18, ncol = 3, nrow = 1)
p16 <- relaplot1(log(log(df_ALG1$grad.rate.ct)), "log grad.rate.ct")
p17 <- relaplot1(log(df_ALG1$withdraw.ct), "log withdraw.ct")
p18 <- relaplot1(df_ALG1$exp, "exp")
ggarrange(p16,p17,p18, ncol = 3, nrow = 1)
p16 <- relaplot1(sqrt(log(df_ALG1$grad.rate.ct)), "log grad.rate.ct")
p17 <- relaplot1(log(df_ALG1$withdraw.ct), "log withdraw.ct")
p18 <- relaplot1(df_ALG1$exp, "exp")
ggarrange(p16,p17,p18, ncol = 3, nrow = 1)
p16 <- relaplot1(sqrt(df_ALG1$grad.rate.ct), "log grad.rate.ct")
p17 <- relaplot1(log(df_ALG1$withdraw.ct), "log withdraw.ct")
p18 <- relaplot1(df_ALG1$exp, "exp")
ggarrange(p16,p17,p18, ncol = 3, nrow = 1)
p16 <- relaplot1(sqrt(df_ALG1$grad.rate.ct), "sqrt grad.rate.ct")
p17 <- relaplot1(log(df_ALG1$grad.rate.ct), "log grad.rate.ct")
p18 <- relaplot1(log(df_ALG1$withdraw.ct), "log withdraw.ct")
p19 <- relaplot1(df_ALG1$exp, "exp")
ggarrange(p16,p17,p18,p19, ncol = 2, nrow = 2)
p12 <- relaplot1(df_ALG1$farms, "farms")
p13 <- relaplot2(df_ALG1$farms, "farms")
p14 <- relaplot1(df_ALG1$grad.rate.ct, "grad.rate.ct")
p15 <- relaplot2(df_ALG1$grad.rate.ct, "grad.rate.ct")
ggarrange(p12,p13,p14,p15, ncol = 2, nrow = 2, widths = c(3,6))
p12 <- relaplot1(df_ALG1$farms, "farms")
p13 <- relaplot2(df_ALG1$farms, "farms")
p14 <- relaplot1(df_ALG1$grad.rate.ct, "grad.rate.ct")
p15 <- relaplot2(df_ALG1$grad.rate.ct, "grad.rate.ct")
ggarrange(p12,p13,p14,p15, ncol = 2, nrow = 2, widths = c(3,6))
p16 <- relaplot1(sqrt(df_ALG1$grad.rate.ct), "sqrt grad.rate.ct")
p17 <- relaplot1(log(df_ALG1$grad.rate.ct), "log grad.rate.ct")
p18 <- relaplot1(sqrt(df_ALG1$withdraw.ct), "sqrt grad.rate.ct")
p19 <- relaplot1(log(df_ALG1$withdraw.ct), "log withdraw.ct")
ggarrange(p16,p17,p18,p19, ncol = 2, nrow = 2)
df_ALG1 <- df_ALG1 %>%
mutate( grad.rate.tsf = sqrt(grad.rate.ct))%>%
mutate( withdraw.tsf = sqrt(withdraw.ct))
df_ALG1
df_ALG1 <- df_ALG1 %>%
mutate( grad.rate.ct = grad.rate - mean(grad.rate, na.rm = TRUE)) %>%
mutate( withdraw.ct = withdraw - mean(withdraw, na.rm = TRUE))
df_ALG1
p16 <- relaplot1(sqrt(df_ALG1$grad.rate.ct), "sqrt grad.rate.ct")
p17 <- relaplot1(log(df_ALG1$grad.rate.ct), "log grad.rate.ct")
p18 <- relaplot1(sqrt(df_ALG1$withdraw.ct), "sqrt withdraw.ct")
p19 <- relaplot1(log(df_ALG1$withdraw.ct), "log withdraw.ct")
ggarrange(p16,p17,p18,p19, ncol = 2, nrow = 2)
sqrt(df_ALG1$withdraw.ct)
p16 <- relaplot1(sqrt(df_ALG1$grad.rate.ct), "sqrt grad.rate.ct")
p17 <- relaplot1(log(df_ALG1$grad.rate.ct), "log grad.rate.ct")
p18 <- relaplot1(sqrt(df_ALG1$withdraw.ct), "sqrt withdraw.ct")
p19 <- relaplot1(log(df_ALG1$withdraw.ct), "log withdraw.ct")
ggarrange(p16,p17,p18,p19, ncol = 2, nrow = 2)
df_ALG1 <- df_ALG1 %>%
mutate( grad.rate.tsf = sqrt(grad.rate.ct))%>%
mutate( withdraw.tsf = ifelse(withdraw.ct > 0, sqrt(withdraw.ct),
-sqrt(abs(withdraw.ct))))
df_ALG1
relaplot1(df_ALG1$withdraw.tsf, "sqrt withdraw.ct")
withdraw.tsf
df_ALG1$withdraw.tsf
plot(df_ALG1$withdraw.tsf)
plot(log(df_ALG1$withdraw.tsf))
relaplot1(df_ALG1$withdraw.tsf, "sqrt withdraw.ct")
p19
df_ALG1 <- func_merge(df_alg1)
df_ALG1 <- df_ALG1 %>%
mutate( grad.rate.ct = grad.rate - mean(grad.rate, na.rm = TRUE)) %>%
mutate( withdraw.ct = withdraw - mean(withdraw, na.rm = TRUE))
df_ALG1 <- df_ALG1 %>%
mutate( grad.rate.sqt = sqt(grad.rate.ct)) %>%
mutate( grad.rate.log = log(grad.rate.ct)) %>%
mutate( withdraw.sqt = ifelse(withdraw.ct > 0, sqrt(withdraw.ct),
-sqrt(abs(withdraw.ct)))) %>%
mutate( withdraw.log = ifelse(withdraw.ct > 0, log(withdraw.ct),
-log(abs(withdraw.ct))))
df_ALG1 <- df_ALG1 %>%
mutate( grad.rate.sqt = sqrt(grad.rate.ct)) %>%
mutate( grad.rate.log = log(grad.rate.ct)) %>%
mutate( withdraw.sqt = ifelse(withdraw.ct > 0, sqrt(withdraw.ct),
-sqrt(abs(withdraw.ct)))) %>%
mutate( withdraw.log = ifelse(withdraw.ct > 0, log(withdraw.ct),
-log(abs(withdraw.ct))))
p16 <- relaplot1(df_ALG1$grad.rate.sqt, "sqrt grad.rate.ct")
p17 <- relaplot1(df_ALG1$grad.rate.log, "log grad.rate.ct")
p18 <- relaplot1(df_ALG1$withdraw.sqt, "sqrt withdraw.ct")
p19 <- relaplot1(df_ALG1$withdraw.log, "log withdraw.ct")
ggarrange(p16,p17,p18,p19, ncol = 2, nrow = 2)
# Boxplot
p1 <- ggplot(df_ALG1, aes(x = reorder(county, pro),
y = pro,fill = county)) + geom_boxplot()+
guides(fill = FALSE) + theme_bw() +
theme(
axis.title.x = element_blank(),
axis.text.x = element_text(angle = 90, hjust = 1,vjust = 0.5)) +
labs( y = 'Distribution',
caption = 'proportion of high performance for Algebra 1 in year 2017')
ALG1_sum <- df_ALG1 %>%
group_by(county) %>%
summarise(mean = mean(pro),
sd = sd(pro))
# Line plot
p2 <- ggplot(ALG1_sum, aes( reorder(factor(county), mean), mean, group = 1)) +
geom_line(alpha = 1/3) +
geom_pointrange(aes(ymax = mean + sd, ymin = mean - sd)) +
labs(caption = 'Error bars') +
theme_minimal() +
theme( axis.title.x = element_blank(),
axis.text.x = element_text(angle = 90, hjust = 1,vjust = 0.5))
ggarrange(p1, p2, ncol = 2)
# Boxplot
p1 <- ggplot(df_ALG1, aes(x = reorder(county, pro),
y = pro,fill = county)) + geom_boxplot()+
guides(fill = FALSE) + theme_bw() +
theme(axis.title.x = element_blank(),
axis.text.x = element_text(angle = 90, hjust = 1,vjust = 0.5)) +
labs( y = 'Distribution',
caption = 'proportion of high performance for Algebra 1 in year 2017')
ALG1_sum <- df_ALG1 %>%
group_by(county) %>%
summarise(mean = mean(pro),
sd = sd(pro))
# Line plot
p2 <- ggplot(ALG1_sum, aes( reorder(factor(county), mean), mean, group = 1)) +
geom_line(alpha = 1/3) +
geom_pointrange(aes(ymax = mean + sd, ymin = mean - sd)) +
labs(caption = 'Error bars') +
theme_bw() +
theme(axis.title.x = element_blank(),
axis.text.x = element_text(angle = 90, hjust = 1,vjust = 0.5))
ggarrange(p1, p2, ncol = 2)
distplot <- function(data, var, var.name){
p <- ggplot(data, aes(x = reorder(county, var),
y = var, fill = county)) + geom_boxplot()+
guides(fill = FALSE) + theme_bw() +
theme(axis.title.x = element_blank(),
axis.text.x = element_text(angle = 90, hjust = 1,vjust = 0.5))+
labs( y = paste("Distribution of ", var.name),
caption = deparse(substitute(data)))
return(p)
}
p3 <- distplot(df_ALG1, df_ALG1$pro, "pro")
p4 <- distplot(df_ALG2, df_ALG2$pro, "pro")
p5 <- distplot(df_ELA, df_ELA$pro, "pro")
ggarrange(p3, p4, p5, nrow = 2, ncol = 2)
distplot <- function(data, var, var.name){
p <- ggplot(data, aes(x = reorder(county, var),
y = var, fill = county)) + geom_boxplot()+
guides(fill = FALSE) + theme_bw() +
theme(axis.title.x = element_blank(),
axis.text.x = element_text(angle = 90, hjust = 1,vjust = 0.5))+
labs( y = paste("Distribution of ", var.name),
caption = deparse(substitute(data)))
return(p)
}
p3 <- distplot(df_ALG1, df_ALG1$pro, "pro")
p4 <- distplot(df_ALG2, df_ALG2$pro, "pro")
p5 <- distplot(df_ELA, df_ELA$pro, "pro")
ggarrange(p3, p4, p5, nrow = 2, ncol = 2)
df_ALG1 <- df_ALG1 %>%
mutate( grad.rate.ct = grad.rate - mean(grad.rate, na.rm = TRUE)) %>%
mutate( withdraw.ct = withdraw - mean(withdraw, na.rm = TRUE))
p10 <- distplot(df_ALG1, df_ALG1$grad.rate.ct, "grad.rate.ct")
p11 <- distplot(df_ALG1, df_ALG1$withdraw.ct, "withdraw.ct")
ggarrange(p10, p11, ncol = 2 )
df_ALG1 <- df_ALG1 %>%
mutate( grad.rate.ct = grad.rate - mean(grad.rate, na.rm = TRUE)) %>%
mutate( withdraw.ct = withdraw - mean(withdraw, na.rm = TRUE))
p10 <- distplot(df_ALG1, df_ALG1$grad.rate.ct, "grad.rate.ct")
p11 <- distplot(df_ALG1, df_ALG1$withdraw.ct, "withdraw.ct")
p10 <- relaplot1(df_ALG1$farms, "farms")
p11 <- relaplot2(df_ALG1$farms, "farms")
p12 <- relaplot1(df_ALG1$grad.rate.ct, "grad.rate.ct")
p13 <- relaplot2(df_ALG1$grad.rate.ct, "grad.rate.ct")
ggarrange(p10,p11,p12,p13,
ncol = 2, nrow = 2, widths = c(3,6))
df_ALG1 <- df_ALG1 %>%
mutate( grad.rate.sqt = sqrt(grad.rate.ct)) %>%
mutate( grad.rate.log = log(grad.rate.ct)) %>%
mutate( withdraw.sqt = ifelse(withdraw.ct > 0, sqrt(withdraw.ct),
-sqrt(abs(withdraw.ct)))) %>%
mutate( withdraw.log = ifelse(withdraw.ct > 0, log(withdraw.ct),
-log(abs(withdraw.ct))))
p14 <- relaplot1(df_ALG1$grad.rate.sqt, "sqrt grad.rate.ct")
p15 <- relaplot1(df_ALG1$grad.rate.log, "log grad.rate.ct")
p16 <- relaplot1(df_ALG1$withdraw.sqt, "sqrt withdraw.ct")
p17 <- relaplot1(df_ALG1$withdraw.log, "log withdraw.ct")
ggarrange(p14,p15,p16,p17, ncol = 2, nrow = 2)
relaplot1 <- function(var, var.name){
p <- ggplot(df_ALG1, aes(x = var, y = pro))+
geom_point()+ geom_smooth(se = FALSE)+
theme(legend.position = "none") +
labs(x = var.name)
return(p)
}
relaplot2 <- function(var, var.name){
p <- ggplot(data = df_ALG1, aes(x = var , y = pro,group = county))+
facet_grid( ~ county, switch = 'x', nrow = 3)+
geom_point(aes(colour = county))+
geom_smooth(se = FALSE, aes(colour = county))+
theme(strip.text=element_text())+
theme(legend.position = "none") +
theme(axis.text = element_blank(),
axis.ticks = element_blank()) +
labs(x = var.name)
return(p)
}
p10 <- relaplot1(df_ALG1$farms, "farms")
p11 <- relaplot2(df_ALG1$farms, "farms")
relaplot1 <- function(var, var.name){
p <- ggplot(df_ALG1, aes(x = var, y = pro))+
geom_point()+ geom_smooth(se = FALSE)+
theme(legend.position = "none") +
labs(x = var.name)
return(p)
}
relaplot2 <- function(var, var.name){
p <- ggplot(data = df_ALG1, aes(x = var , y = pro,group = county))+
facet_wrap( ~ county, switch = 'x', nrow = 3)+
geom_point(aes(colour = county))+
geom_smooth(se = FALSE, aes(colour = county))+
theme(strip.text=element_text())+
theme(legend.position = "none") +
theme(axis.text = element_blank(),
axis.ticks = element_blank()) +
labs(x = var.name)
return(p)
}
p10 <- relaplot1(df_ALG1$farms, "farms")
p11 <- relaplot2(df_ALG1$farms, "farms")
p12 <- relaplot1(df_ALG1$grad.rate.ct, "grad.rate.ct")
p13 <- relaplot2(df_ALG1$grad.rate.ct, "grad.rate.ct")
ggarrange(p10,p11,p12,p13,
ncol = 2, nrow = 2, widths = c(3,6))
